{"version":3,"file":"factories.js","sourceRoot":"","sources":["../../../tmp/ontimize/services/factories.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken, Injector } from '@angular/core';\n\nimport { AppConfig } from '../config/app-config';\nimport { IExportService } from '../types/export-service.interface';\nimport { IFileService } from '../types/file-service.interface';\nimport { IPermissionsService, Util } from '../util/util';\nimport { OntimizeEEService } from './ontimize-ee.service';\nimport { OntimizeExportService } from './ontimize-export.service';\nimport { OntimizeFileService } from './ontimize-file.service';\nimport { OntimizeService } from './ontimize.service';\nimport { OntimizeEEPermissionsService, OntimizePermissionsService } from './permissions/o-permissions.module';\nimport { OTranslateService } from './translate/o-translate.service';\n\n/* ----------------------------------------------------------------------------------------------------\n * ----------------------------------------- INJECTION TOKENS -----------------------------------------\n * ---------------------------------------------------------------------------------------------------- */\n\n/**\n * Injection token that can be used to replace the data service `OntimizeService` or `OntimizeEEService`.\n */\nexport const O_DATA_SERVICE = new InjectionToken('Ontimize data service');\n\n/**\n * Injection token that can be used to replace the translate service `OTranslateService`.\n */\nexport const O_TRANSLATE_SERVICE = new InjectionToken('Translate service');\n\n/**\n * Injection token that can be used to replace the file service `OntimizeFileService`.\n */\nexport const O_FILE_SERVICE = new InjectionToken<IFileService>('File uploader service');\n\n/**\n * Injection token that can be used to replace the exportation service `OntimizeExportService`.\n */\nexport const O_EXPORT_SERVICE = new InjectionToken<IExportService>('Export service');\n\n/**\n * Injection token that can be used to replace the permission service `OntimizePermissionsService or OntimizeEEPermissionsService`.\n */\nexport const O_PERMISSION_SERVICE = new InjectionToken<IPermissionsService>('Permission service');\n\n/* ----------------------------------------------------------------------------------------------------\n * --------------------------------------------- FACTORIES --------------------------------------------\n * ---------------------------------------------------------------------------------------------------- */\n\n/**\n * Creates a new instance of the data service.\n */\nexport function dataServiceFactory(injector: Injector): any {\n  const serviceClass = getInjectionTokenValue(O_DATA_SERVICE, injector);\n  const service = createServiceInstance(serviceClass, injector);\n  if (Util.isDefined(service)) {\n    return service;\n  }\n  const config = injector.get(AppConfig).getConfiguration();\n  if (typeof (config.serviceType) === 'undefined') {\n    return new OntimizeService(injector);\n  } else if ('OntimizeEE' === config.serviceType) {\n    return new OntimizeEEService(injector);\n  }\n  return createServiceInstance(config.serviceType, injector);\n}\n\n/**\n * Creates a new instance of the translate service.\n */\nexport function translateServiceFactory(injector: Injector): any {\n  const serviceClass = getInjectionTokenValue(O_TRANSLATE_SERVICE, injector);\n  const service = createServiceInstance(serviceClass, injector);\n  return Util.isDefined(service) ? service : new OTranslateService(injector);\n}\n\n/**\n * Creates a new instance of the file service.\n */\nexport function fileServiceFactory(injector: Injector): IFileService {\n  const serviceClass = getInjectionTokenValue(O_FILE_SERVICE, injector);\n  const service = createServiceInstance(serviceClass, injector);\n  return Util.isDefined(service) ? service : new OntimizeFileService(injector);\n}\n\n/**\n * Creates a new instance of the exportation service.\n */\nexport function exportServiceFactory(injector: Injector): IExportService {\n  const serviceClass = getInjectionTokenValue(O_EXPORT_SERVICE, injector);\n  const service = createServiceInstance(serviceClass, injector);\n  if (Util.isDefined(service)) {\n    return service;\n  }\n  const config = injector.get(AppConfig).getConfiguration();\n  if (typeof (config.exportServiceType) === 'undefined') {\n    return new OntimizeExportService(injector);\n  }\n  return createServiceInstance(config.exportServiceType, injector);\n}\n\n/**\n * Creates a new instance of the permission service.\n */\nexport function permissionsServiceFactory(injector: Injector): IPermissionsService {\n  const serviceClass = getInjectionTokenValue(O_PERMISSION_SERVICE, injector);\n  const service = createServiceInstance(serviceClass, injector);\n  if (Util.isDefined(service)) {\n    return service;\n  }\n  const config = injector.get(AppConfig).getConfiguration();\n  if (!Util.isDefined(config.permissionsServiceType) || 'OntimizePermissions' === config.permissionsServiceType) {\n    return new OntimizePermissionsService(injector);\n  } else if ('OntimizeEEPermissions' === config.permissionsServiceType) {\n    return new OntimizeEEPermissionsService(injector);\n  }\n  return createServiceInstance(config.permissionsServiceType, injector);\n}\n\n/* ----------------------------------------------------------------------------------------------------\n * ----------------------------------------- Utility methods ------------------------------------------\n * ---------------------------------------------------------------------------------------------------- */\n\n/**\n * Returns the value for the provided injection token\n * @param token the injection token\n * @param injector the injector\n */\nfunction getInjectionTokenValue<T>(token: InjectionToken<T>, injector: Injector): T {\n  let service: T;\n  try {\n    service = injector.get(token);\n  } catch (e) {\n    // No value provided for the injection token\n  }\n  return service;\n}\n\n/**\n * Returns an instance of the provided service class\n * @param clazz the class reference\n * @param injector the injector\n */\nfunction createServiceInstance(clazz: any, injector: Injector) {\n  if (!Util.isDefined(clazz)) {\n    return;\n  }\n  let newInstance = Object.create(clazz.prototype);\n  clazz.apply(newInstance, [injector]);\n  return newInstance;\n}\n"]}